@* @using CorUI.Services *@
@* @using Microsoft.Extensions.DependencyInjection *@
@* @inject NavigationManager Nav *@
@* @inject IServiceProvider Services *@
@* @inject IWindowService _svc *@
@* *@
@* @if (_opened && _dialog is not null) *@
@* { *@
@*     <Dialog Title="@_title" Opened="true" OpenedChanged="OnOpenedChanged" BackdropDismissable="@_dialog.BackdropDismissable" DismissWithEscape="@_dialog.DismissWithEscape"> *@
@*         <iframe style="width:100%;height:70vh;border:none;" src="@_contentUrl"></iframe> *@
@*     </Dialog> *@
@* } *@
@* *@
@* @code { *@
@*     [Parameter] public string Title { get; set; } = ""; *@
@* *@
@*     private bool _opened; *@
@*     private string _contentUrl = ""; *@
@*     private string _title = ""; *@
@*     private global::CorUI.Dialog? _dialog; *@
@*     private DotNetObjectReference<DialogPresenter>? _selfRef; *@
@* *@
@*     protected override void OnInitialized() *@
@*     { *@
@*         if (_svc is not null) *@
@*         { *@
@*             _svc.DialogRequested += OnDialogRequested; *@
@*         } *@
@*         _selfRef = DotNetObjectReference.Create(this); *@
@*     } *@
@* *@
@*     private Task OnDialogRequested(global::CorUI.Dialog dialog) *@
@*     { *@
@*         _dialog = dialog; *@
@*         var path = string.IsNullOrWhiteSpace(dialog.ContentPath) ? "/" : dialog.ContentPath; *@
@*         _contentUrl = Nav.ToAbsoluteUri(path).ToString(); *@
@*         _title = dialog.Title; *@
@*         _opened = true; *@
@*         StateHasChanged(); *@
@*         return Task.CompletedTask; *@
@*     } *@
@* *@
@*     private void OnOpenedChanged(bool open) *@
@*     { *@
@*         _opened = open; *@
@*         if (!open) *@
@*         { *@
@*             _svc?.CloseActiveDialog(); *@
@*         } *@
@*     } *@
@* *@
@*     public void Dispose() *@
@*     { *@
@*         if (_svc is not null) *@
@*         { *@
@*             _svc.DialogRequested -= OnDialogRequested; *@
@*         } *@
@*         _selfRef?.Dispose(); *@
@*     } *@
@* *@
@*     // No cross-view dismissal wiring by request *@
@* } *@
@* *@
@* *@
